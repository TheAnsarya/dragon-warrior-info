# Dragon Warrior Label Inventory

## Overview

The **Label Inventory** is a comprehensive spreadsheet (`labels_inventory.csv`) containing all labels, variables, functions, and constants from the Dragon Warrior NES disassembly. This resource is designed to facilitate systematic refactoring of abbreviated label names into more descriptive forms.

## Purpose

The Dragon Warrior disassembly uses abbreviated label names for historical reasons (space constraints, typing efficiency). This inventory provides:

- **Complete catalog** of all 22,949+ labels across the codebase
- **Probable expanded names** generated by AI pattern recognition
- **Reference counts** to identify heavily-used labels
- **Contextual descriptions** from nearby comments
- **System categorization** to understand each label's role

## File Location

- **CSV File:** `labels_inventory.csv` (in repository root)
- **Generator Script:** `tools/generate_label_inventory.py`

## Spreadsheet Columns

| Column | Description | Example |
|--------|-------------|---------|
| `file_name` | Source file containing the label definition | `Bank00.asm` |
| `address` | Memory address (for variables/constants) | `$6008` |
| `name` | Current abbreviated label name | `WindowEraseWidth` |
| `label` | Label identifier (same as `name`) | `WindowEraseWidth` |
| `probable_expanded_name` | AI-generated expanded form | `WindowEraseWidth` |
| `reference_count` | Number of times referenced across all files | `3` |
| `system_area` | Categorized functional area | `Graphics` |
| `description` | Context from nearby comments | `Unused window variable \| Window erase height in blocks \| Window erase width in tiles.` |

## Abbreviation Expansion Patterns

The `probable_expanded_name` column is generated using these common abbreviation patterns:

| Abbreviation | Expansion | Example Transformation |
|--------------|-----------|------------------------|
| `Tbl` | Table | `ThRmMobTbl` → `ThroneRoomMobileTable` |
| `Ptr` | Pointer | `BlockDataPtrLB` → `BlockDataPointerLowByte` |
| `Dat` | Data | `CoverDatUB` → `CoverDataUpperByte` |
| `Wdth` | Width | `WindowEraseWdth` → `WindowEraseWidth` |
| `Flgs` | Flags | `BlkRemoveFlgs` → `BlockRemoveFlags` |
| `Pos` | Position | `WindowRowPos` → `WindowRowPosition` |
| `Mob` | Mobile | `BrecMobTbl` → `BrecconaryMobileTable` |
| `Stat` | Static | `TantStatTbl` → `TantegelStaticTable` |
| `Num` | Number | `DivideNum1LB` → `DivideNumber1LowByte` |
| `Buf` | Buffer | `AttributeTblBuf` → `AttributeTableBuffer` |
| `Cnt` | Count | `PPUEntryCount` → (already expanded) |
| `Idx` | Index | `AttribBufIndex` → `AttributeBufferIndex` |
| `Tmp` | Temporary | `TmpValue` → `TemporaryValue` |
| `Calc` | Calculate | `CalcPPUBufAddr` → `CalculatePPUBufferAddress` |
| `Attrib` | Attribute | `VertAttribLoop` → `VerticalAttributeLoop` |
| `Vert` | Vertical | `VertRowLoop` → `VerticalRowLoop` |
| `Horz` | Horizontal | `HorzDgnBlock` → `HorizontalDungeonBlock` |
| `Dgn` | Dungeon | `DgnScrollX` → `DungeonScrollX` |
| `Brec` | Brecconary | `BrecMobTbl` → `BrecconaryMobileTable` |
| `Cant` | Cantlin | `CantStatTbl` → `CantlinStaticTable` |
| `Gar` | Garinham | `GarMobTbl` → `GarinhamMobileTable` |
| `Rim` | Rimuldar | `RimMobTbl` → `RimuldarMobileTable` |
| `Tant` | Tantegel | `TantStatTbl` → `TantegelStaticTable` |
| `Spr` | Sprite | `SprPalette` → `SpritePalette` |
| `Gfx` | Graphics | `GFXTilesPtr` → `GraphicsTilesPointer` |
| `Wpn` | Weapon | `WpnAtkPwr` → `WeaponAttackPower` |
| `Eqip` | Equip | `EqippedItems` → `EquippedItems` |
| `Trsr` | Treasure | `TrsrXPos` → `TreasureXPosition` |
| `Spel` | Spell | `SpelPower` → `SpellPower` |
| `Rand` | Random | `UpdateRandNum` → `UpdateRandomNumber` |
| `Nm` | Name | `ActiveNmTbl` → `ActiveNameTable` |
| `Ppu` | PPU | `PPUBufCount` → `PPUBufferCount` |
| `Nmi` | NMI | `NMIStatus` → `NMIStatus` |
| `Oam` | OAM | `OAMBuffer` → `OAMBuffer` |
| `Pal` | Palette | `DrgnLrdPal` → `DragonlordPalette` |
| `LB` | LowByte | `MapDatPtrLB` → `MapDataPointerLowByte` |
| `UB` / `HB` | UpperByte | `MapDatPtrUB` → `MapDataPointerUpperByte` |
| `LUB` | LowUpperByte | `DatPntrLUB` → `DataPointerLowUpperByte` |

### Special Location Abbreviations

| Abbreviation | Expansion |
|--------------|-----------|
| `ThRm` | ThroneRoom |
| `DLBF` | DragonlordBeforeFloor |
| `TaSL` | TantegelSwampLevel |
| `TaDL` | TantegelDungeonLevel |
| `Rnbw` | Rainbow |

## System Area Categories

Labels are automatically categorized into these functional areas:

| Category | Description | Keywords |
|----------|-------------|----------|
| **General** | Uncategorized or multi-purpose code | (default) |
| **PPU** | Picture Processing Unit (graphics chip) | ppu, nametable, attrib, palette, scroll |
| **Graphics** | Sprite and tile rendering | gfx, sprite, tile, chr, oam |
| **Map** | World and dungeon map data | map, block, world, overworld |
| **Dialog** | Text and message windows | dialog, text, message, window |
| **Items** | Inventory and equipment | item, weapon, armor, equip, treasure |
| **Audio** | Music and sound effects | sound, music, sfx, apu |
| **Player** | Hero stats and progression | hero, player, level, exp, gold |
| **NPC** | Non-player characters | npc, mob, static |
| **Combat** | Battle system | battle, enemy, attack, defense, damage |
| **Spells** | Magic system | spell, magic, heal, radiant |
| **Input** | Controller handling | controller, button, input, joypad |
| **System** | Low-level system code | init, reset, nmi, irq, bank |
| **Math** | Calculation routines | divide, multiply, random, calc |
| **Location** | Specific towns/dungeons | tantegel, brecconary, garinham, cantlin, rimuldar |
| **Alias** | Abbreviated label aliases | (marked as .alias) |

## Statistics

**Total Labels:** 22,949

### By File

| File | Label Count | Description |
|------|-------------|-------------|
| `Dragon_Warrior_Defines.asm` | 1,105 | RAM variables, constants, aliases |
| `Bank00.asm` | 5,175 | Fixed PRG bank (core game logic) |
| `Bank01.asm` | 7,029 | Switchable PRG bank 1 |
| `Bank02.asm` | 1,727 | Switchable PRG bank 2 (dialog text) |
| `Bank03.asm` | 7,913 | Switchable PRG bank 3 (code) |

### By System Area (Top Categories)

| Category | Count | Percentage |
|----------|-------|------------|
| General | 7,716 | 33.6% |
| PPU | 2,535 | 11.0% |
| Map | 2,385 | 10.4% |
| Graphics | 2,300 | 10.0% |
| Dialog | 1,431 | 6.2% |
| Items | 1,282 | 5.6% |
| Audio | 1,220 | 5.3% |
| Player | 1,139 | 5.0% |
| NPC | 803 | 3.5% |
| Combat | 695 | 3.0% |

## Usage

### Opening the Spreadsheet

```powershell
# Open in Excel
Start-Process labels_inventory.csv

# Open in VS Code
code labels_inventory.csv

# Import in Python/pandas
import pandas as pd
df = pd.read_csv('labels_inventory.csv')
```

### Filtering Examples

**Find all NPC-related labels:**
```
Filter: system_area = "NPC"
```

**Find heavily-referenced labels (>50 uses):**
```
Filter: reference_count > 50
Sort: reference_count (descending)
```

**Find all pointer variables:**
```
Filter: name CONTAINS "Ptr"
```

**Find all abbreviations needing expansion:**
```
Filter: name != probable_expanded_name
```

**Find all Bank00 labels without addresses (code labels):**
```
Filter: file_name = "Bank00.asm" AND address = ""
```

### Manual Expansion Workflow

1. **Filter by system area** to focus on related labels
2. **Review `probable_expanded_name`** - AI suggestions are 80-90% accurate
3. **Check `description`** for context from original comments
4. **Verify `reference_count`** - high counts require careful renaming
5. **Update labels** using batch find/replace or refactoring tools
6. **Test build** to ensure no breaking changes

### Reference Count Interpretation

- **0-2 references:** Safe to rename, minimal impact
- **3-10 references:** Review usage patterns first
- **11-50 references:** Significant refactoring effort
- **50+ references:** Core variables, ensure backward compatibility

## Regenerating the Inventory

If the source code changes, regenerate the CSV:

```powershell
python tools\generate_label_inventory.py
```

The script will:
1. Parse all `.asm` files in `source_files/`
2. Extract labels, addresses, and contexts
3. Generate expansion suggestions
4. Count references across all files
5. Write updated `labels_inventory.csv`

## Notes

### AI-Generated Expansions

The `probable_expanded_name` column is generated algorithmically and may need manual verification:

- **Accuracy:** ~80-90% for common patterns
- **Context-dependent:** Some abbreviations have multiple meanings
- **Review required:** Always check against code context before applying

### Address Formats

- **RAM Variables:** `$00`-`$07FF` (zero page and RAM)
- **Memory-Mapped I/O:** `$2000`-`$5FFF` (PPU, APU, etc.)
- **SRAM:** `$6000`-`$7FFF` (save game data)
- **Code Labels:** No address (relative to bank base)

### Alias Labels

The inventory includes both:
- **Primary definitions:** `.alias LabelName $6008` (with address)
- **Abbreviated aliases:** `.alias ShortName LongName` (no address)

Abbreviated aliases are marked with `system_area = "Alias"` and show target in description.

## Integration with Documentation

This label inventory complements other documentation:

- **[Dragon Warrior Defines](datacrystal/Dragon_Warrior_Defines.asm)** - Original variable definitions
- **[Memory Map](datacrystal/)** - Memory layout documentation
- **[Session Summary](SESSION_SUMMARY_2024_11.md)** - Recent refactoring work

## Future Enhancements

Potential improvements to the label inventory:

- [ ] Type annotations (byte/word/pointer/array)
- [ ] Cross-reference to data crystal documentation
- [ ] Suggested refactoring priority (based on reference count + clarity)
- [ ] Grouping by functional modules
- [ ] Export to symbol file formats (.sym, .mlb)

## See Also

- **[Documentation Index](INDEX.md)** - Main documentation hub
- **[Asset Catalog](asset_catalog/)** - Game asset documentation
- **[Build Documentation](build/)** - Build system guides

---

**Generated:** November 2024  
**Generator:** `tools/generate_label_inventory.py`  
**Total Labels:** 22,949  
**Files Analyzed:** 5 assembly files
